<!doctype html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twilight Quiz</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Crimson+Pro:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }

    :root {
      --peach: #F2C89B;
      --peach-deep: #E8A87C;
      --lavender: #C4BEE8;
      --lavender-deep: #8B83C4;
      --bg-dark: #0E0D1F;
      --glass: rgba(255,255,255,0.055);
      --glass-border: rgba(255,255,255,0.11);
      --text: #EEE8FF;
      --text-muted: rgba(200,192,230,0.6);
    }

    body {
      font-family: 'Crimson Pro', serif;
      background: var(--bg-dark);
      color: var(--text);
      overflow-x: hidden;
    }

    /* ══ BACKGROUND ══ */
    .bg-scene {
      position: fixed; inset: 0; z-index: 0;
      overflow: hidden; pointer-events: none;
    }
    .bg-sky {
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 90% 55% at 50% 0%, #2A1E50 0%, transparent 65%),
        radial-gradient(ellipse 55% 45% at 72% 18%, #3D2650 0%, transparent 60%),
        radial-gradient(ellipse 40% 30% at 28% 25%, #1E2A45 0%, transparent 55%),
        linear-gradient(180deg, #0C0B1E 0%, #181535 28%, #221C42 52%, #161330 100%);
    }
    .bg-orb {
      position: absolute; top: 10%; left: 54%;
      width: 130px; height: 130px;
      background: radial-gradient(circle, rgba(242,200,155,0.95) 0%, rgba(242,175,110,0.45) 38%, transparent 68%);
      border-radius: 50%; filter: blur(9px);
      animation: orbPulse 7s ease-in-out infinite;
    }
    @keyframes orbPulse {
      0%,100% { opacity:.72; transform:scale(1); }
      50%      { opacity:1;   transform:scale(1.1); }
    }
    .cloud {
      position: absolute; border-radius: 50%;
      filter: blur(30px); opacity: 0;
      animation: cloudDrift 20s ease-in-out infinite;
    }
    .cloud-1 { width:320px;height:80px;background:rgba(200,170,230,0.12);top:8%;left:15%;animation-delay:0s; }
    .cloud-2 { width:250px;height:60px;background:rgba(242,168,90,0.08);top:14%;left:55%;animation-delay:5s; }
    .cloud-3 { width:200px;height:50px;background:rgba(180,160,220,0.1);top:5%;left:38%;animation-delay:10s; }
    @keyframes cloudDrift {
      0%  { opacity:0; transform:translateX(0); }
      15% { opacity:1; }
      85% { opacity:1; }
      100%{ opacity:0; transform:translateX(40px); }
    }
    .bg-skyline {
      position: absolute; bottom: 34%; left: 0; right: 0;
      height: 130px; background: #08071A;
      clip-path: polygon(
        0% 100%, 0% 72%, 1.5% 72%, 1.5% 52%, 2.2% 52%, 2.2% 46%, 2.7% 28%, 3.2% 46%, 3.2% 52%, 4% 52%, 4% 72%,
        5% 72%, 5% 55%, 6% 55%, 6% 40%, 6.8% 40%, 6.8% 34%, 7.3% 18%, 7.8% 34%, 7.8% 40%, 8.8% 40%, 8.8% 72%,
        10% 72%, 10% 58%, 11% 58%, 11% 44%, 12% 44%, 12% 72%,
        13% 72%, 13% 48%, 13.8% 48%, 14.2% 25%, 14.7% 10%, 15.2% 25%, 15.7% 48%, 15.7% 72%,
        17% 72%, 17% 58%, 18% 58%, 18% 52%, 19.5% 52%, 19.5% 72%,
        21% 72%, 21% 50%, 22% 50%, 22.5% 30%, 23% 50%, 23% 72%,
        24.5% 72%, 24.5% 60%, 25.5% 60%, 25.5% 55%, 27% 55%, 27% 72%,
        28.5% 72%, 28.5% 47%, 29.5% 47%, 30% 26%, 30.5% 47%, 30.5% 72%,
        32% 72%, 32% 58%, 33% 58%, 33% 54%, 34.5% 54%, 34.5% 72%,
        36% 72%, 36% 48%, 37% 48%, 37.5% 22%, 38% 48%, 38% 72%,
        39.5% 72%, 39.5% 58%, 40.5% 58%, 40.5% 52%, 42% 52%, 42% 72%,
        43.5% 72%, 43.5% 50%, 44.5% 50%, 45% 32%, 45.5% 50%, 45.5% 72%,
        47% 72%, 47% 60%, 48% 60%, 48% 56%, 49.5% 56%, 49.5% 72%,
        51% 72%, 51% 46%, 52% 46%, 52.5% 20%, 53% 46%, 53% 72%,
        54.5% 72%, 54.5% 58%, 55.5% 58%, 55.5% 54%, 57% 54%, 57% 72%,
        58.5% 72%, 58.5% 44%, 59.5% 44%, 60% 18%, 60.5% 44%, 60.5% 72%,
        62% 72%, 62% 56%, 63% 56%, 63% 52%, 64.5% 52%, 64.5% 72%,
        66% 72%, 66% 50%, 67% 50%, 67.5% 34%, 68% 50%, 68% 72%,
        69.5% 72%, 69.5% 60%, 70.5% 60%, 70.5% 56%, 72% 56%, 72% 72%,
        73.5% 72%, 73.5% 46%, 74.5% 46%, 75% 28%, 75.5% 46%, 75.5% 72%,
        77% 72%, 77% 58%, 78% 58%, 78% 62%, 79.5% 62%, 79.5% 72%,
        81% 72%, 81% 50%, 82% 50%, 82.5% 36%, 83% 50%, 83% 72%,
        84.5% 72%, 84.5% 60%, 85.5% 60%, 85.5% 56%, 87% 56%, 87% 72%,
        88.5% 72%, 88.5% 46%, 89.5% 46%, 90% 22%, 90.5% 46%, 90.5% 72%,
        92% 72%, 92% 58%, 93% 58%, 93% 54%, 94.5% 54%, 94.5% 72%,
        96% 72%, 96% 50%, 97% 50%, 97.5% 38%, 98% 50%, 98% 72%,
        100% 72%, 100% 100%
      );
    }
    .bg-water {
      position: absolute; bottom: 0; left: 0; right: 0;
      height: 37%; background: linear-gradient(180deg, #0C0B1C 0%, #0F0E28 100%);
      overflow: hidden;
    }
    .bg-water::before {
      content: ''; position: absolute; inset: 0;
      background: repeating-linear-gradient(180deg,
        transparent 0px, transparent 3px,
        rgba(160,140,220,0.025) 3px, rgba(160,140,220,0.025) 4px);
    }
    .water-glow {
      position: absolute; border-radius: 50%;
      filter: blur(14px); animation: shimmer 4.5s ease-in-out infinite;
    }
    .wg1{width:5px;height:85px;background:rgba(242,168,90,0.55);top:4%;left:28%;}
    .wg2{width:7px;height:65px;background:rgba(242,168,90,0.45);top:8%;left:46%;animation-delay:1.2s;}
    .wg3{width:4px;height:75px;background:rgba(200,160,255,0.3);top:6%;left:60%;animation-delay:2.2s;}
    .wg4{width:9px;height:95px;background:rgba(242,168,90,0.5);top:2%;left:74%;animation-delay:.6s;}
    .wg5{width:5px;height:70px;background:rgba(180,200,255,0.28);top:10%;left:18%;animation-delay:1.8s;}
    .wg6{width:6px;height:55px;background:rgba(242,168,90,0.35);top:12%;left:84%;animation-delay:3s;}
    @keyframes shimmer {
      0%,100%{opacity:.55;transform:scaleX(1);}
      50%{opacity:1;transform:scaleX(1.6);}
    }



    /* Window bar */
    .window-bar {
      position:fixed; top:0; left:0; right:0; height:26px;
      background:rgba(10,9,22,0.97);
      border-bottom:1px solid rgba(255,255,255,0.07);
      z-index:30; display:flex; align-items:center;
      padding:0 15vw; gap:7px;
    }
    .wdot{width:11px;height:11px;border-radius:50%;}
    .wdot-1{background:rgba(242,168,90,0.8);}
    .wdot-2{background:rgba(130,210,130,0.55);}
    .wdot-3{background:rgba(200,160,255,0.55);}
    .window-title {
      margin:0 auto;
      font-family:'Cormorant Garamond',serif;
      font-size:11px; letter-spacing:0.25em;
      text-transform:uppercase; color:rgba(200,192,230,0.4);
    }

    /* Glow blobs */
    .glow-blob{position:fixed;border-radius:50%;pointer-events:none;z-index:1;animation:blobFloat 9s ease-in-out infinite;}
    .gb1{width:350px;height:350px;top:8%;left:12%;background:radial-gradient(circle,rgba(139,131,196,0.07) 0%,transparent 70%);}
    .gb2{width:250px;height:250px;top:35%;right:18%;background:radial-gradient(circle,rgba(242,168,90,0.06) 0%,transparent 70%);animation-delay:3.5s;}
    .gb3{width:200px;height:200px;bottom:20%;left:30%;background:radial-gradient(circle,rgba(180,160,230,0.05) 0%,transparent 70%);animation-delay:6s;}
    @keyframes blobFloat{0%,100%{transform:translateY(0);opacity:.75;}50%{transform:translateY(-22px);opacity:1;}}

    /* ══ UI COMPONENTS ══ */
    .glass-card {
      background:var(--glass);
      border:1px solid var(--glass-border);
      border-radius:18px;
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
      position:relative; overflow:hidden;
      transition:border-color .3s,transform .3s,box-shadow .3s;
    }
    .glass-card::before {
      content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.14),transparent);
    }

    .glass-input {
      background:rgba(14,13,31,0.55);
      border:1px solid rgba(255,255,255,0.14);
      backdrop-filter:blur(8px);
      color:var(--text);
      font-family:'Crimson Pro',serif;
      font-size:15px;
      transition:all .3s;
    }
    .glass-input::placeholder{color:rgba(200,192,230,0.4);}
    .glass-input:focus{border-color:var(--peach);box-shadow:0 0 20px rgba(242,200,155,0.18);outline:none;}

    .glow-btn {
      background:linear-gradient(135deg,#F2C89B 0%,#E8A87C 100%);
      box-shadow:0 4px 22px rgba(232,168,124,0.4);
      color:#0E0D1F;
      font-family:'Cormorant Garamond',serif;
      font-weight:600; font-size:15px; letter-spacing:0.08em;
      transition:all .3s; border:none; cursor:pointer;
    }
    .glow-btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(232,168,124,0.6);}
    .glow-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;}

    .secondary-btn {
      background:rgba(196,190,232,0.1);
      border:1px solid rgba(255,255,255,0.14);
      color:var(--text);
      font-family:'Cormorant Garamond',serif;
      font-size:14px; letter-spacing:0.06em;
      transition:all .3s; cursor:pointer;
    }
    .secondary-btn:hover{background:rgba(196,190,232,0.18);border-color:rgba(255,255,255,0.25);}

    .category-tag {
      background:rgba(242,200,155,0.12);
      border:1px solid rgba(242,200,155,0.28);
      color:var(--peach);
      font-family:'Cormorant Garamond',serif;
      font-size:12px; letter-spacing:0.12em;
    }

    .option-btn {
      background:rgba(14,13,31,0.4);
      border:1.5px solid rgba(255,255,255,0.12);
      color:var(--text);
      font-family:'Crimson Pro',serif;
      font-size:16px;
      transition:all .3s; cursor:pointer; text-align:left;
    }
    .option-btn:hover:not(:disabled){border-color:var(--peach);background:rgba(242,200,155,0.08);transform:translateX(4px);}
    .option-btn.selected{border-color:var(--peach);background:rgba(242,200,155,0.14);}
    .option-btn.correct{border-color:#6ee7a0;background:rgba(110,231,160,0.12);}
    .option-btn.wrong{border-color:#f87171;background:rgba(248,113,113,0.12);}

    .timer-ring{transform:rotate(-90deg);}
    .timer-ring circle{transition:stroke-dashoffset 1s linear;}

    .section-label{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:0.3em;text-transform:uppercase;color:var(--peach);opacity:.8;}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);margin:20px 0;}

    .scroll-area{scrollbar-width:thin;scrollbar-color:rgba(242,200,155,0.25) transparent;}
    .scroll-area::-webkit-scrollbar{width:5px;}
    .scroll-area::-webkit-scrollbar-track{background:transparent;}
    .scroll-area::-webkit-scrollbar-thumb{background:rgba(242,200,155,0.25);border-radius:3px;}

    .fade-in{animation:fadeIn .5s ease-out both;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

    .toast{animation:slideIn .3s ease-out;}
    @keyframes slideIn{from{transform:translateX(110%);opacity:0;}to{transform:translateX(0);opacity:1;}}

    .quiz-card:hover{transform:translateY(-4px);}
    .font-playfair{font-family:'Playfair Display',serif;}
    .font-cormorant{font-family:'Cormorant Garamond',serif;}
  </style>

</head>

<body class="scroll-area" style="min-height:100vh;overflow-y:auto;">

  <!-- Background -->

  <div class="bg-scene">
    <div class="bg-sky"></div>
    <div class="bg-orb"></div>
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="cloud cloud-3"></div>
    <div class="bg-skyline"></div>
    <div class="bg-water">
      <div class="water-glow wg1"></div><div class="water-glow wg2"></div>
      <div class="water-glow wg3"></div><div class="water-glow wg4"></div>
      <div class="water-glow wg5"></div><div class="water-glow wg6"></div>
    </div>
  </div>
  <div class="glow-blob gb1"></div>
  <div class="glow-blob gb2"></div>
  <div class="glow-blob gb3"></div>

  <div class="window-bar">
    <div class="wdot wdot-1"></div>
    <div class="wdot wdot-2"></div>
    <div class="wdot wdot-3"></div>
    <span class="window-title">Twilight Quiz</span>
  </div>

  <!-- Toast -->

  <div id="toast-container" class="fixed top-10 right-4 z-50 flex flex-col gap-2"></div>

  <!-- App -->

  <div id="app" class="relative z-10" style="padding-top:26px;">

```
<!-- HOME -->
<div id="home-view" class="min-h-screen p-4 md:p-8 lg:p-12">
  <div class="max-w-5xl mx-auto">
    <header class="text-center mb-10 fade-in">
      <div class="section-label mb-3">✦ Study · Master · Excel</div>
      <h1 class="font-playfair text-5xl md:text-6xl font-normal mb-3"
          style="color:var(--peach);text-shadow:0 0 50px rgba(242,200,155,0.25);">Twilight Quiz</h1>
      <p class="font-cormorant text-xl opacity-60 tracking-wide italic">Create and master your quizzes</p>
    </header>

    <div class="glass-card p-4 mb-6 flex flex-col md:flex-row gap-4 items-center fade-in" style="animation-delay:.1s;">
      <div class="flex-1 w-full relative">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <input type="text" id="search-input" placeholder="Search quizzes…" class="glass-input w-full pl-11 pr-4 py-3 rounded-xl">
      </div>
      <div class="flex gap-3 flex-wrap justify-center">
        <button onclick="showView('bookmarks-view')" class="secondary-btn px-5 py-3 rounded-xl flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
          </svg>
          <span class="hidden sm:inline">Bookmarks</span>
        </button>
        <button onclick="exportQuizzes()" class="secondary-btn px-5 py-3 rounded-xl flex items-center gap-2" title="Export all quizzes to a file">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
          </svg>
          <span class="hidden sm:inline">Export</span>
        </button>
        <button onclick="document.getElementById('import-input').click()" class="secondary-btn px-5 py-3 rounded-xl flex items-center gap-2" title="Import quizzes from a file">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l4-4m0 0l4 4m-4-4v12"/>
          </svg>
          <span class="hidden sm:inline">Import</span>
        </button>
        <input type="file" id="import-input" accept=".json" class="hidden" onchange="importQuizzes(event)">
        <button onclick="showCreateQuiz()" class="glow-btn px-5 py-3 rounded-xl flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          New Quiz
        </button>
      </div>
    </div>

    <div id="categories-bar" class="flex flex-wrap gap-2 mb-6 fade-in" style="animation-delay:.18s;"></div>
    <div id="quiz-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 fade-in" style="animation-delay:.24s;"></div>
  </div>
</div>

<!-- CREATE / EDIT -->
<div id="create-quiz-view" class="min-h-screen p-4 md:p-8 lg:p-12 hidden">
  <div class="max-w-2xl mx-auto">
    <button onclick="showView('home-view')" class="secondary-btn px-4 py-2 rounded-lg mb-6 flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg> Back
    </button>
    <div class="glass-card p-6 md:p-8 fade-in">
      <div class="section-label mb-2">Configure</div>
      <h2 id="create-quiz-title" class="font-playfair text-3xl font-normal mb-6" style="color:var(--peach);">Create New Quiz</h2>
      <form id="quiz-form" onsubmit="event.preventDefault(); saveQuiz();">
        <div class="space-y-5">
          <div>
            <label class="section-label block mb-2">Quiz Name *</label>
            <input type="text" id="quiz-name" required class="glass-input w-full px-4 py-3 rounded-xl" placeholder="e.g., Islamic History">
          </div>
          <div>
            <label class="section-label block mb-2">Category</label>
            <input type="text" id="quiz-category" class="glass-input w-full px-4 py-3 rounded-xl" placeholder="e.g., Fiqh, History, Science">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="section-label block mb-2">Seconds / Question *</label>
              <input type="number" id="quiz-time" required min="5" max="300" value="30" class="glass-input w-full px-4 py-3 rounded-xl">
            </div>
            <div>
              <label class="section-label block mb-2">Negative Marking</label>
              <input type="number" id="quiz-negative" step="0.25" min="0" max="1" value="0.25" class="glass-input w-full px-4 py-3 rounded-xl">
            </div>
          </div>
          <div class="divider"></div>
          <div>
            <div class="flex items-center justify-between mb-4">
              <div class="section-label">Questions</div>
              <button type="button" onclick="addQuestion()" class="secondary-btn px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg> Add Question
              </button>
            </div>
            <div id="questions-container" class="space-y-4"></div>
          </div>
          <div class="pt-2">
            <button type="submit" id="save-quiz-btn" class="glow-btn w-full py-3 rounded-xl">Save Quiz</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- PLAY -->
<div id="quiz-play-view" class="min-h-screen p-4 md:p-8 lg:p-12 hidden">
  <div class="max-w-2xl mx-auto">
    <div class="glass-card p-6 md:p-8 fade-in">
      <div class="flex items-center justify-between mb-6">
        <div>
          <div class="section-label mb-1">Now Playing</div>
          <h2 id="playing-quiz-name" class="font-playfair text-2xl font-normal" style="color:var(--peach);"></h2>
          <p id="question-counter" class="font-cormorant text-sm opacity-60 mt-1 tracking-wider"></p>
        </div>
        <div class="flex items-center gap-5">
          <div id="score-display" class="text-right">
            <div class="section-label">Score</div>
            <p class="font-playfair text-2xl" style="color:var(--peach);">0</p>
          </div>
          <div class="relative w-14 h-14">
            <svg class="timer-ring w-full h-full">
              <circle cx="28" cy="28" r="24" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="3"/>
              <circle id="timer-circle" cx="28" cy="28" r="24" fill="none" stroke="var(--peach)" stroke-width="3" stroke-linecap="round" stroke-dasharray="150.8" stroke-dashoffset="0"/>
            </svg>
            <span id="timer-text" class="absolute inset-0 flex items-center justify-center font-playfair text-base font-semibold">30</span>
          </div>
        </div>
      </div>
      <div class="divider"></div>
      <div id="question-container" class="mb-6">
        <p id="question-text" class="font-playfair text-xl md:text-2xl font-normal mb-6 leading-relaxed"></p>
        <div id="options-container" class="space-y-3"></div>
      </div>
      <div id="explanation-container" class="hidden glass-card rounded-xl p-4 mb-5"
           style="background:rgba(196,190,232,0.08);border-color:rgba(242,200,155,0.2);">
        <p class="section-label mb-2">✦ Explanation</p>
        <p id="explanation-text" class="font-cormorant text-base opacity-85 leading-relaxed italic"></p>
      </div>
      <div class="flex justify-between items-center">
        <button onclick="quitQuiz()" class="secondary-btn px-5 py-2 rounded-lg text-sm">Quit</button>
        <button id="next-btn" onclick="nextQuestion()" class="glow-btn px-6 py-2 rounded-lg hidden">Next →</button>
      </div>
    </div>
  </div>
</div>

<!-- RESULTS -->
<div id="results-view" class="min-h-screen p-4 md:p-8 lg:p-12 hidden">
  <div class="max-w-2xl mx-auto">
    <div class="glass-card p-6 md:p-8 fade-in">
      <div class="text-center mb-8">
        <div class="w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center"
             style="background:linear-gradient(135deg,rgba(242,200,155,0.15),rgba(232,168,124,0.15));border:1.5px solid rgba(242,200,155,0.4);">
          <svg class="w-10 h-10" style="color:var(--peach);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="section-label mb-2">Results</div>
        <h2 class="font-playfair text-4xl font-normal mb-1" style="color:var(--peach);">Quiz Complete</h2>
        <p id="result-quiz-name" class="font-cormorant text-lg opacity-55 italic"></p>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
        <div class="glass-card p-4 text-center rounded-xl">
          <p class="font-playfair text-3xl" style="color:var(--peach);" id="final-score">0</p>
          <p class="section-label mt-1">Score</p>
        </div>
        <div class="glass-card p-4 text-center rounded-xl">
          <p class="font-playfair text-3xl text-green-400" id="correct-count">0</p>
          <p class="section-label mt-1">Correct</p>
        </div>
        <div class="glass-card p-4 text-center rounded-xl">
          <p class="font-playfair text-3xl text-red-400" id="wrong-count">0</p>
          <p class="section-label mt-1">Wrong</p>
        </div>
        <div class="glass-card p-4 text-center rounded-xl">
          <p class="font-playfair text-3xl text-yellow-400" id="skipped-count">0</p>
          <p class="section-label mt-1">Skipped</p>
        </div>
      </div>
      <div class="mb-8">
        <div class="section-label mb-4">Question Details</div>
        <div id="results-details" class="space-y-3 max-h-96 overflow-y-auto scroll-area pr-1"></div>
      </div>
      <div class="flex flex-col sm:flex-row gap-3">
        <button onclick="retakeQuiz()" class="secondary-btn flex-1 py-3 rounded-xl flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg> Retake
        </button>
        <button onclick="showView('home-view')" class="glow-btn flex-1 py-3 rounded-xl">Back to Home</button>
      </div>
    </div>
  </div>
</div>

<!-- BOOKMARKS -->
<div id="bookmarks-view" class="min-h-screen p-4 md:p-8 lg:p-12 hidden">
  <div class="max-w-3xl mx-auto">
    <button onclick="showView('home-view')" class="secondary-btn px-4 py-2 rounded-lg mb-6 flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg> Back
    </button>
    <div class="section-label mb-2">Saved for Review</div>
    <h2 class="font-playfair text-4xl font-normal mb-6" style="color:var(--peach);">Bookmarked Questions</h2>
    <div id="bookmarks-container" class="space-y-4"></div>
  </div>
</div>

<!-- DELETE MODAL -->
<div id="delete-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4"
     style="background:rgba(10,9,22,0.85);backdrop-filter:blur(6px);">
  <div class="glass-card p-6 max-w-md w-full fade-in">
    <div class="section-label mb-2">Confirm</div>
    <h3 class="font-playfair text-2xl font-normal mb-3" style="color:var(--peach);">Delete Quiz?</h3>
    <p class="font-cormorant text-base opacity-70 mb-6 leading-relaxed">This will permanently delete this quiz and all its questions.</p>
    <div class="flex gap-3">
      <button onclick="closeDeleteModal()" class="secondary-btn flex-1 py-3 rounded-xl">Cancel</button>
      <button id="confirm-delete-btn" onclick="confirmDelete()"
              class="flex-1 py-3 rounded-xl font-semibold font-cormorant text-base tracking-wide"
              style="background:rgba(248,113,113,0.15);border:1px solid rgba(248,113,113,0.4);color:#f87171;">
        Delete
      </button>
    </div>
  </div>
</div>
```

  </div><!-- end #app -->

  <script>
    // ═══════════════════════════════════════
    //  LOCALSTORAGE DATA LAYER
    //  Replaces the SDK — saves in your browser
    // ═══════════════════════════════════════
    const STORAGE_KEY = 'twilight_quiz_data';

    function loadData() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch (e) { return []; }
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function dbCreate(item) {
      const data = loadData();
      item.__id = 'id_' + Date.now() + '_' + Math.random().toString(36).slice(2);
      data.push(item);
      saveData(data);
      return item;
    }

    function dbUpdate(item) {
      const data = loadData();
      const idx = data.findIndex(d => d.__id === item.__id);
      if (idx !== -1) { data[idx] = item; saveData(data); }
      return item;
    }

    function dbDelete(item) {
      const data = loadData().filter(d => d.__id !== item.__id);
      saveData(data);
    }

    // ═══════════════════════════════════════
    //  APP STATE
    // ═══════════════════════════════════════
    let quizzes = [], questions = [];
    let currentQuiz = null, currentQuestionIndex = 0;
    let currentQuestions = [], quizResults = [];
    let score = 0, timerInterval = null, timeLeft = 0;
    let selectedAnswer = null, answerSubmitted = false;
    let editingQuizId = null, deleteQuizId = null;
    let currentCategory = '', questionCounter = 0;

    function refreshData() {
      const data = loadData();
      quizzes   = data.filter(d => d.type === 'quiz');
      questions = data.filter(d => d.type === 'question');
      renderQuizGrid();
      renderCategoriesBar();
      renderBookmarks();
    }

    // Run on load
    refreshData();

    // Search
    document.getElementById('search-input').addEventListener('input', e => {
      renderQuizGrid(e.target.value.toLowerCase());
    });

    // ═══════════════════════════════════════
    //  TOAST
    // ═══════════════════════════════════════
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast glass-card px-4 py-3 rounded-xl flex items-center gap-3';
      const icon = type === 'success'
        ? '<svg class="w-4 h-4 flex-shrink-0" style="color:#6ee7a0;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'
        : '<svg class="w-4 h-4 flex-shrink-0" style="color:#f87171;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
      toast.innerHTML = `${icon}<span class="font-cormorant text-sm tracking-wide">${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0'; toast.style.transform = 'translateX(110%)';
        toast.style.transition = 'all .3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ═══════════════════════════════════════
    //  VIEWS
    // ═══════════════════════════════════════
    function showView(viewId) {
      ['home-view','create-quiz-view','quiz-play-view','results-view','bookmarks-view'].forEach(v => {
        document.getElementById(v).classList.add('hidden');
      });
      document.getElementById(viewId).classList.remove('hidden');
      if (viewId === 'home-view') { stopTimer(); editingQuizId = null; refreshData(); }
      if (viewId === 'bookmarks-view') renderBookmarks();
    }

    // ═══════════════════════════════════════
    //  CATEGORIES
    // ═══════════════════════════════════════
    function renderCategoriesBar() {
      const cats = [...new Set(quizzes.map(q => q.category).filter(c => c && c.trim()))];
      const bar = document.getElementById('categories-bar');
      const activeStyle = 'background:rgba(242,200,155,0.25);border-color:rgba(242,200,155,0.6);';
      bar.innerHTML = `<button onclick="filterByCategory('')" class="category-filter-btn category-tag px-4 py-2 rounded-full text-sm transition-all" style="${currentCategory===''?activeStyle:''}">All</button>`;
      cats.forEach(cat => {
        bar.innerHTML += `<button onclick="filterByCategory('${escapeHtml(cat)}')" class="category-filter-btn category-tag px-4 py-2 rounded-full text-sm transition-all" style="${currentCategory===cat?activeStyle:''}">${escapeHtml(cat)}</button>`;
      });
    }

    function filterByCategory(cat) {
      currentCategory = cat;
      renderCategoriesBar();
      renderQuizGrid(document.getElementById('search-input').value.toLowerCase());
    }

    // ═══════════════════════════════════════
    //  QUIZ GRID
    // ═══════════════════════════════════════
    function renderQuizGrid(searchTerm = '') {
      const grid = document.getElementById('quiz-grid');
      let filtered = quizzes;
      if (currentCategory) filtered = filtered.filter(q => q.category === currentCategory);
      if (searchTerm) filtered = filtered.filter(q =>
        q.quiz_name.toLowerCase().includes(searchTerm) ||
        (q.category && q.category.toLowerCase().includes(searchTerm))
      );

      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-16 opacity-50">
            <div class="font-cormorant text-6xl mb-4" style="color:var(--peach);opacity:.3;">✦</div>
            <p class="font-playfair text-xl mb-2">${searchTerm || currentCategory ? 'No matches found' : 'No quizzes yet'}</p>
            <p class="font-cormorant text-base opacity-70">${searchTerm || currentCategory ? 'Try a different search' : 'Create your first quiz to begin'}</p>
          </div>`;
        return;
      }

      grid.innerHTML = filtered.map(quiz => {
        const qs = questions.filter(q => q.quiz_id === quiz.quiz_id);
        const bookCount = qs.filter(q => q.is_bookmarked).length;
        return `
          <div class="glass-card quiz-card p-5 cursor-pointer transition-all" onclick="startQuiz('${quiz.quiz_id}')">
            <div class="flex items-start justify-between mb-3">
              <div>${quiz.category ? `<span class="category-tag px-3 py-1 rounded-full text-xs">${escapeHtml(quiz.category)}</span>` : ''}</div>
              <div class="flex gap-1 quiz-actions" style="opacity:0;transition:opacity .2s;" onclick="event.stopPropagation()">
                <button onclick="editQuiz('${quiz.quiz_id}')" class="p-2 rounded-lg hover:bg-white/10 transition-colors" title="Edit">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="showDeleteModal('${quiz.quiz_id}')" class="p-2 rounded-lg hover:bg-red-500/20 transition-colors" style="color:#f87171;" title="Delete">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </div>
            <h3 class="font-playfair text-xl font-normal mb-3 leading-snug" style="color:var(--peach);">${escapeHtml(quiz.quiz_name)}</h3>
            <div class="flex flex-wrap gap-3 font-cormorant text-sm opacity-60">
              <span>${qs.length} question${qs.length!==1?'s':''}</span>
              <span>·</span>
              <span>${quiz.time_per_question}s each</span>
              ${bookCount > 0 ? `<span>·</span><span style="color:var(--peach);">☆ ${bookCount}</span>` : ''}
            </div>
          </div>`;
      }).join('');

      // Hover show/hide actions
      document.querySelectorAll('.quiz-card').forEach(card => {
        const actions = card.querySelector('.quiz-actions');
        if (actions) {
          card.addEventListener('mouseenter', () => actions.style.opacity = '1');
          card.addEventListener('mouseleave', () => actions.style.opacity = '0');
        }
      });
    }

    // ═══════════════════════════════════════
    //  CREATE / EDIT QUIZ
    // ═══════════════════════════════════════
    function showCreateQuiz() {
      editingQuizId = null;
      document.getElementById('create-quiz-title').textContent = 'Create New Quiz';
      document.getElementById('quiz-form').reset();
      document.getElementById('quiz-time').value = 30;
      document.getElementById('quiz-negative').value = 0.25;
      document.getElementById('questions-container').innerHTML = '';
      questionCounter = 0;
      addQuestion();
      showView('create-quiz-view');
    }

    function editQuiz(quizId) {
      const quiz = quizzes.find(q => q.quiz_id === quizId);
      if (!quiz) return;
      editingQuizId = quizId;
      document.getElementById('create-quiz-title').textContent = 'Edit Quiz';
      document.getElementById('quiz-name').value = quiz.quiz_name;
      document.getElementById('quiz-category').value = quiz.category || '';
      document.getElementById('quiz-time').value = quiz.time_per_question;
      document.getElementById('quiz-negative').value = quiz.negative_marking;
      const quizQuestions = questions.filter(q => q.quiz_id === quizId);
      document.getElementById('questions-container').innerHTML = '';
      questionCounter = 0;
      if (quizQuestions.length === 0) addQuestion();
      else quizQuestions.forEach(q => {
        const opts = JSON.parse(q.options || '["","","",""]');
        addQuestion(q.question_text, opts, q.correct_answer, q.explanation || '', q.__id);
      });
      showView('create-quiz-view');
    }

    function addQuestion(text='', options=['','','',''], correct=0, explanation='', existingId=null) {
      questionCounter++;
      const container = document.getElementById('questions-container');
      const div = document.createElement('div');
      div.className = 'glass-card rounded-xl p-4 fade-in';
      div.dataset.questionNum = questionCounter;
      if (existingId) div.dataset.existingId = existingId;
      div.innerHTML = `
        <div class="flex items-center justify-between mb-3">
          <span class="section-label">Question ${questionCounter}</span>
          <button type="button" onclick="removeQuestion(this)" class="p-1 rounded hover:bg-red-500/20 transition-colors" style="color:#f87171;">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="space-y-3">
          <input type="text" class="question-text glass-input w-full px-3 py-2 rounded-lg text-sm" placeholder="Enter question…" value="${escapeHtml(text)}" required>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            ${options.map((opt,i) => `
              <div class="flex items-center gap-2">
                <input type="radio" name="correct-${questionCounter}" class="correct-radio" value="${i}" ${i===correct?'checked':''} style="accent-color:var(--peach);">
                <input type="text" class="option-input glass-input flex-1 px-3 py-2 rounded-lg text-sm" placeholder="Option ${i+1}" value="${escapeHtml(opt)}" required>
              </div>`).join('')}
          </div>
          <div>
            <label class="section-label block mb-1">Explanation (optional)</label>
            <textarea class="explanation-input glass-input w-full px-3 py-2 rounded-lg text-sm resize-none" rows="2" placeholder="Add explanation…">${escapeHtml(explanation)}</textarea>

```
      </div>
    </div>`;
  container.appendChild(div);
}

function removeQuestion(btn) {
  const container = document.getElementById('questions-container');
  if (container.children.length <= 1) { showToast('Need at least one question', 'error'); return; }
  btn.closest('.glass-card').remove();
  renumberQuestions();
}

function renumberQuestions() {
  [...document.getElementById('questions-container').children].forEach((div, i) => {
    div.querySelector('.section-label').textContent = `Question ${i+1}`;
  });
}

function saveQuiz() {
  const btn = document.getElementById('save-quiz-btn');
  btn.disabled = true; btn.textContent = 'Saving…';

  try {
    const quizName = document.getElementById('quiz-name').value.trim();
    const category = document.getElementById('quiz-category').value.trim();
    const timePerQuestion = parseInt(document.getElementById('quiz-time').value);
    const negativeMarking = parseFloat(document.getElementById('quiz-negative').value);

    if (!quizName) { showToast('Please enter a quiz name', 'error'); return; }

    const questionDivs = document.getElementById('questions-container').children;
    const questionsData = [];

    for (const div of questionDivs) {
      const text = div.querySelector('.question-text').value.trim();
      const opts = [...div.querySelectorAll('.option-input')].map(i => i.value.trim());
      const correctRadio = div.querySelector('.correct-radio:checked');
      const correct = correctRadio ? parseInt(correctRadio.value) : 0;
      const explanation = div.querySelector('.explanation-input').value.trim();
      const existingId = div.dataset.existingId;

      if (!text || opts.some(o => !o)) {
        showToast('Please fill all question fields', 'error');
        return;
      }
      questionsData.push({ text, opts, correct, explanation, existingId });
    }

    const quizId = editingQuizId || ('quiz_' + Date.now());

    if (editingQuizId) {
      // Update quiz
      const existing = quizzes.find(q => q.quiz_id === editingQuizId);
      if (existing) dbUpdate({ ...existing, quiz_name:quizName, category, time_per_question:timePerQuestion, negative_marking:negativeMarking });

      // Delete removed questions
      const oldQs = questions.filter(q => q.quiz_id === editingQuizId);
      const keepIds = questionsData.filter(q => q.existingId).map(q => q.existingId);
      oldQs.forEach(q => { if (!keepIds.includes(q.__id)) dbDelete(q); });

      // Update / create questions
      questionsData.forEach((qd, i) => {
        if (qd.existingId) {
          const eq = questions.find(q => q.__id === qd.existingId);
          if (eq) dbUpdate({ ...eq, question_text:qd.text, options:JSON.stringify(qd.opts), correct_answer:qd.correct, explanation:qd.explanation });
        } else {
          dbCreate({ type:'question', quiz_id:quizId, question_id:'q_'+Date.now()+'_'+i, question_text:qd.text, options:JSON.stringify(qd.opts), correct_answer:qd.correct, explanation:qd.explanation, is_bookmarked:false, bookmark_reason:'' });
        }
      });

    } else {
      // Create new quiz
      dbCreate({ type:'quiz', quiz_id:quizId, quiz_name:quizName, category, time_per_question:timePerQuestion, negative_marking:negativeMarking, created_at:new Date().toISOString() });
      questionsData.forEach((qd, i) => {
        dbCreate({ type:'question', quiz_id:quizId, question_id:'q_'+Date.now()+'_'+i, question_text:qd.text, options:JSON.stringify(qd.opts), correct_answer:qd.correct, explanation:qd.explanation, is_bookmarked:false, bookmark_reason:'' });
      });
    }

    showToast(editingQuizId ? 'Quiz updated! ✓' : 'Quiz created! ✓');
    showView('home-view');

  } catch (err) {
    showToast('Something went wrong. Try again.', 'error');
    console.error(err);
  } finally {
    btn.disabled = false; btn.textContent = 'Save Quiz';
  }
}

// ═══════════════════════════════════════
//  DELETE
// ═══════════════════════════════════════
function showDeleteModal(quizId) {
  event.stopPropagation();
  deleteQuizId = quizId;
  document.getElementById('delete-modal').classList.remove('hidden');
  document.getElementById('delete-modal').classList.add('flex');
}
function closeDeleteModal() {
  deleteQuizId = null;
  document.getElementById('delete-modal').classList.add('hidden');
  document.getElementById('delete-modal').classList.remove('flex');
}
function confirmDelete() {
  if (!deleteQuizId) return;
  const btn = document.getElementById('confirm-delete-btn');
  btn.disabled = true; btn.textContent = 'Deleting…';
  try {
    const quiz = quizzes.find(q => q.quiz_id === deleteQuizId);
    questions.filter(q => q.quiz_id === deleteQuizId).forEach(q => dbDelete(q));
    if (quiz) dbDelete(quiz);
    showToast('Quiz deleted');
    closeDeleteModal();
    refreshData();
  } catch (e) {
    showToast('Failed to delete', 'error');
  } finally {
    btn.disabled = false; btn.textContent = 'Delete';
  }
}

// ═══════════════════════════════════════
//  QUIZ PLAY
// ═══════════════════════════════════════
function startQuiz(quizId) {
  currentQuiz = quizzes.find(q => q.quiz_id === quizId);
  if (!currentQuiz) return;
  currentQuestions = questions.filter(q => q.quiz_id === quizId);
  if (currentQuestions.length === 0) { showToast('No questions in this quiz', 'error'); return; }
  currentQuestionIndex = 0; score = 0; quizResults = [];
  document.getElementById('playing-quiz-name').textContent = currentQuiz.quiz_name;
  showView('quiz-play-view');
  loadQuestion();
}

function loadQuestion() {
  const question = currentQuestions[currentQuestionIndex];
  const options = JSON.parse(question.options);
  selectedAnswer = null; answerSubmitted = false;
  document.getElementById('question-counter').textContent = `Question ${currentQuestionIndex+1} of ${currentQuestions.length}`;
  document.getElementById('score-display').innerHTML = `<div class="section-label">Score</div><p class="font-playfair text-2xl" style="color:var(--peach);">${score.toFixed(2)}</p>`;
  document.getElementById('question-text').textContent = question.question_text;
  document.getElementById('next-btn').classList.add('hidden');
  document.getElementById('explanation-container').classList.add('hidden');
  document.getElementById('options-container').innerHTML = options.map((opt, i) => `
    <button class="option-btn w-full px-4 py-3 rounded-xl" data-index="${i}" onclick="selectOption(${i})">
      <span class="inline-flex items-center justify-center w-7 h-7 rounded-full mr-3 text-sm font-cormorant"
            style="background:rgba(242,200,155,0.15);color:var(--peach);">${String.fromCharCode(65+i)}</span>
      ${escapeHtml(opt)}
    </button>`).join('');
  startTimer();
}

function startTimer() {
  stopTimer();
  timeLeft = currentQuiz.time_per_question;
  updateTimerDisplay();
  timerInterval = setInterval(() => {
    timeLeft--; updateTimerDisplay();
    if (timeLeft <= 0) handleTimeout();
  }, 1000);
}
function stopTimer() { if (timerInterval) { clearInterval(timerInterval); timerInterval = null; } }

function updateTimerDisplay() {
  const total = currentQuiz.time_per_question;
  const offset = 150.8 * (1 - timeLeft / total);
  document.getElementById('timer-text').textContent = timeLeft;
  document.getElementById('timer-circle').style.strokeDashoffset = offset;
  document.getElementById('timer-circle').style.stroke = timeLeft <= 5 ? '#f87171' : 'var(--peach)';
}

function selectOption(index) {
  if (answerSubmitted) return;
  selectedAnswer = index;
  document.querySelectorAll('.option-btn').forEach((btn, i) => {
    btn.classList.remove('selected');
    if (i === index) btn.classList.add('selected');
  });
  submitAnswer();
}

function handleTimeout() {
  if (answerSubmitted) return;
  stopTimer(); answerSubmitted = true;
  const question = currentQuestions[currentQuestionIndex];
  quizResults.push({ question:question.question_text, options:JSON.parse(question.options), correct:question.correct_answer, selected:null, status:'skipped', explanation:question.explanation });
  bookmarkQuestion(question, 'skipped');
  showExplanation(question);
  setTimeout(() => nextQuestion(), 2000);
}

function submitAnswer() {
  if (answerSubmitted) return;
  stopTimer(); answerSubmitted = true;
  const question = currentQuestions[currentQuestionIndex];
  const correct = question.correct_answer;
  const isCorrect = selectedAnswer === correct;
  if (isCorrect) score += 1;
  else { score -= currentQuiz.negative_marking; bookmarkQuestion(question, 'wrong'); }
  quizResults.push({ question:question.question_text, options:JSON.parse(question.options), correct, selected:selectedAnswer, status:isCorrect?'correct':'wrong', explanation:question.explanation });
  document.querySelectorAll('.option-btn').forEach((btn, i) => {
    btn.disabled = true;
    if (i === correct) btn.classList.add('correct');
    else if (i === selectedAnswer && !isCorrect) btn.classList.add('wrong');
  });
  document.getElementById('score-display').innerHTML = `<div class="section-label">Score</div><p class="font-playfair text-2xl" style="color:var(--peach);">${score.toFixed(2)}</p>`;
  showExplanation(question);
}

function showExplanation(question) {
  if (question.explanation) {
    document.getElementById('explanation-text').textContent = question.explanation;
    document.getElementById('explanation-container').classList.remove('hidden');
  }
  document.getElementById('next-btn').classList.remove('hidden');
}

function bookmarkQuestion(question, reason) {
  try { dbUpdate({ ...question, is_bookmarked:true, bookmark_reason:reason }); refreshData(); }
  catch(e) { console.error('Bookmark failed'); }
}

function nextQuestion() {
  currentQuestionIndex++;
  if (currentQuestionIndex >= currentQuestions.length) showResults();
  else loadQuestion();
}
function quitQuiz() { stopTimer(); showView('home-view'); }

// ═══════════════════════════════════════
//  RESULTS
// ═══════════════════════════════════════
function showResults() {
  stopTimer();
  const correct = quizResults.filter(r => r.status==='correct').length;
  const wrong   = quizResults.filter(r => r.status==='wrong').length;
  const skipped = quizResults.filter(r => r.status==='skipped').length;
  document.getElementById('result-quiz-name').textContent = currentQuiz.quiz_name;
  document.getElementById('final-score').textContent = score.toFixed(2);
  document.getElementById('correct-count').textContent = correct;
  document.getElementById('wrong-count').textContent = wrong;
  document.getElementById('skipped-count').textContent = skipped;

  const statusBorder = { correct:'border-green-400', wrong:'border-red-400', skipped:'border-yellow-400' };
  const statusIcon = {
    correct:'<svg class="w-4 h-4 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
    wrong:'<svg class="w-4 h-4 text-red-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>',
    skipped:'<svg class="w-4 h-4 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
  };

  document.getElementById('results-details').innerHTML = quizResults.map((r,i) => `
    <div class="glass-card rounded-xl p-4 border-l-4 ${statusBorder[r.status]}">
      <div class="flex items-start gap-3">
        ${statusIcon[r.status]}
        <div class="flex-1">
          <p class="font-cormorant text-base font-medium mb-2">Q${i+1}: ${escapeHtml(r.question)}</p>
          <div class="font-cormorant text-sm space-y-1 opacity-75">
            ${r.options.map((opt,j)=>`
              <p class="${j===r.correct?'text-green-400 font-medium':''} ${j===r.selected&&r.selected!==r.correct?'text-red-400 line-through':''}">
                ${String.fromCharCode(65+j)}. ${escapeHtml(opt)}
                ${j===r.correct?' ✓':''}
                ${j===r.selected&&r.selected!==r.correct?' (yours)':''}
              </p>`).join('')}
            ${r.status==='skipped'?'<p class="text-yellow-400 italic">Time expired</p>':''}
          </div>
          ${r.explanation?`<p class="mt-2 font-cormorant text-sm opacity-65 italic">✦ ${escapeHtml(r.explanation)}</p>`:''}
        </div>
      </div>
    </div>`).join('');

  showView('results-view');
}

function retakeQuiz() { if (currentQuiz) startQuiz(currentQuiz.quiz_id); }

// ═══════════════════════════════════════
//  BOOKMARKS
// ═══════════════════════════════════════
function renderBookmarks() {
  const container = document.getElementById('bookmarks-container');
  const bookmarked = questions.filter(q => q.is_bookmarked);
  if (bookmarked.length === 0) {
    container.innerHTML = `
      <div class="text-center py-16 opacity-50">
        <div class="font-cormorant text-6xl mb-4" style="color:var(--peach);opacity:.3;">☆</div>
        <p class="font-playfair text-xl mb-2">No bookmarks yet</p>
        <p class="font-cormorant text-base opacity-70">Wrong & skipped questions will appear here</p>
      </div>`;
    return;
  }
  const grouped = {};
  bookmarked.forEach(q => { if (!grouped[q.quiz_id]) grouped[q.quiz_id]=[]; grouped[q.quiz_id].push(q); });
  container.innerHTML = Object.entries(grouped).map(([quizId, qs]) => {
    const quiz = quizzes.find(q => q.quiz_id === quizId);
    return `
      <div class="glass-card rounded-2xl p-5 mb-4 fade-in">
        <h3 class="font-playfair text-xl font-normal mb-4" style="color:var(--peach);">${escapeHtml(quiz ? quiz.quiz_name : 'Unknown Quiz')}</h3>
        <div class="space-y-3">
          ${qs.map(q => {
            const opts = JSON.parse(q.options||'[]');
            const borderColor = q.bookmark_reason==='wrong'?'border-red-400':'border-yellow-400';
            const tag = q.bookmark_reason==='wrong'
              ? '<span class="font-cormorant text-xs px-2 py-1 rounded-full" style="background:rgba(248,113,113,0.15);color:#f87171;">Wrong</span>'
              : '<span class="font-cormorant text-xs px-2 py-1 rounded-full" style="background:rgba(250,204,21,0.15);color:#fbbf24;">Skipped</span>';
            return `
              <div class="glass-card rounded-xl p-4 border-l-4 ${borderColor}">
                <div class="flex items-start justify-between mb-2 gap-3">
                  <p class="font-cormorant text-base font-medium flex-1">${escapeHtml(q.question_text)}</p>
                  ${tag}
                </div>
                <div class="font-cormorant text-sm space-y-1 opacity-75">
                  ${opts.map((opt,j)=>`
                    <p class="${j===q.correct_answer?'text-green-400 font-medium':''}">
                      ${String.fromCharCode(65+j)}. ${escapeHtml(opt)}${j===q.correct_answer?' ✓':''}
                    </p>`).join('')}
                </div>
                ${q.explanation?`<p class="mt-2 font-cormorant text-sm opacity-65 italic">✦ ${escapeHtml(q.explanation)}</p>`:''}
              </div>`;
          }).join('')}
        </div>
      </div>`;
  }).join('');
}

// ═══════════════════════════════════════
//  EXPORT / IMPORT
// ═══════════════════════════════════════
function exportQuizzes() {
  const data = loadData();
  if (data.length === 0) { showToast('No quizzes to export!', 'error'); return; }
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().slice(0,10);
  a.href = url;
  a.download = `twilight-quizzes-${date}.json`;
  a.click();
  URL.revokeObjectURL(url);
  showToast(`Exported ${quizzes.length} quiz${quizzes.length!==1?'zes':''} successfully! ✓`);
}

function importQuizzes(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const imported = JSON.parse(e.target.result);
      if (!Array.isArray(imported)) { showToast('Invalid file format', 'error'); return; }
      const existing = loadData();
      const existingIds = new Set(existing.map(d => d.__id));
      let added = 0;
      imported.forEach(item => {
        if (!existingIds.has(item.__id)) { existing.push(item); added++; }
      });
      saveData(existing);
      refreshData();
      const quizCount = imported.filter(d => d.type === 'quiz').length;
      showToast(added > 0 ? `Imported ${quizCount} quiz${quizCount!==1?'zes':''} successfully! ✓` : 'These quizzes are already saved!');
    } catch (err) {
      showToast('Could not read file. Make sure it is a valid export.', 'error');
    }
    event.target.value = '';
  };
  reader.readAsText(file);
}

// ═══════════════════════════════════════
//  UTILS
// ═══════════════════════════════════════
function escapeHtml(text) {
  if (!text) return '';
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}
```

  </script>
</body>
</html>